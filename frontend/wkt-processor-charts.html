<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WKT Analytics Dashboard - Axes Systems</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="styles/wkt-processor-charts.css">
</head>
<body>
    <header>
        <h1>WKT Analytics Dashboard - Axes Systems</h1>
        <a href="index.html" class="nav-back">‚Üê Back to Dashboard</a>
    </header>

    <div class="container">
        <div class="sidebar">
            <div class="panel-box">
                <h3>UPLOAD WKT FILE</h3>
                <div class="upload-zone" id="upload-zone">
                    <div class="upload-icon">üìÅ</div>
                    <div>Drag & Drop WKT file here</div>
                    <div>or click to browse</div>
                </div>
                <input type="file" id="file-input" accept=".wkt,.txt" hidden>
                <button id="btn-process" class="btn-primary" disabled>Analyze WKT File</button>
                <button id="btn-clear" class="btn-secondary">Clear All</button>
            </div>

            <div class="panel-box">
                <h3>ANALYTICS METRICS</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="value" id="stat-features">0</div>
                        <div class="label">Features</div>
                    </div>
                    <div class="stat-item">
                        <div class="value" id="stat-types">0</div>
                        <div class="label">Types</div>
                    </div>
                    <div class="stat-item">
                        <div class="value" id="stat-displaced">0</div>
                        <div class="label">Displaced</div>
                    </div>
                    <div class="stat-item">
                        <div class="value" id="stat-time">-</div>
                        <div class="label">Time</div>
                    </div>
                </div>
            </div>

            <div class="panel-box">
                <h3>üóÇÔ∏è FEATURES</h3>
                <div class="feature-list" id="feature-list">
                    <div class="feature-item">No features loaded</div>
                </div>
            </div>

            <div class="panel-box">
                <h3>üíæ EXPORT</h3>
                <button id="btn-export-json" class="btn-secondary" disabled>Export JSON</button>
                <button id="btn-export-wkt" class="btn-secondary" disabled>Export WKT</button>
            </div>
        </div>

        <div class="visualization-container">
            <div class="viz-tabs">
                
                <button class="viz-tab active" data-view="overview">Overview</button>
                <button class="viz-tab" data-view="features">Features</button>
                <button class="viz-tab" data-view="displacement">Displacement</button>
                <button class="viz-tab" data-view="data">Data Table</button>
                <button class="viz-tab" data-view="map">Graph View</button>
                <button class="viz-tab" data-view="mapview">Map View</button>
            </div>

            <div class="viz-content">
                <div class="viz-placeholder" id="viz-placeholder">
                    üìä Upload a WKT file to see analytics
                    <div>Charts, graphs, and statistical analysis</div>
                </div>

                <div id="panel-map" class="viz-panel active">
                    <div class="viz-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="chart-card">
                            <h3>Before Displacement - Original Map</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-map-before"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>After Displacement - Improved Map</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-map-after"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="panel-overview" class="viz-panel">
                    <div class="viz-grid">
                        <div class="chart-card">
                            <h3>Feature Types</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-types"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Priority Distribution</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-priorities"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Width Analysis</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-widths"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Processing Summary</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-metrics"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="panel-features" class="viz-panel">
                    <div class="viz-grid">
                        <div class="chart-card" style="grid-column: span 2;">
                            <h3>Coordinate Distribution</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-coords"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Vertices per Feature</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-vertices"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Color Distribution</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-colors"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="panel-displacement" class="viz-panel">
                    <div class="viz-grid">
                        <div class="chart-card" style="grid-column: span 2;">
                            <h3>Displacement by Feature</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-displacement"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Overlap Resolution</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-overlaps"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Displacement Stats</h3>
                            <div class="chart-wrapper">
                                <canvas id="chart-disp-stats"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="panel-data" class="viz-panel">
                    <div class="viz-grid" style="grid-template-columns: 1fr; padding: 20px;">
                        <div class="chart-card">
                            <h3>Feature Data</h3>
                            <div style="overflow-x: auto;">
                                <table class="data-table" id="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Type</th>
                                            <th>Priority</th>
                                            <th>Width (m)</th>
                                            <th>Vertices</th>
                                            <th>Displaced</th>
                                            <th>Displacement (m)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td colspan="7" style="text-align: center; padding: 30px;">No data available</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="panel-mapview" class="viz-panel">
                    <div style="padding: 20px; position: relative;">
                        <div id="leaflet-map"></div>
                        
                        <!-- Map Controls -->
                        <div class="map-controls-panel">
                            <button class="map-control-btn" onclick="fitAllFeatures()">
                                üéØ Fit All
                            </button>
                            <button class="map-control-btn" onclick="showDisplacedOnly()">
                                üî¥ Show Displaced
                            </button>
                            <button class="map-control-btn" onclick="showPreservedOnly()">
                                üü¢ Show Preserved
                            </button>
                            <button class="map-control-btn" onclick="showAllFeatures()">
                                üëÅÔ∏è Show All
                            </button>
                            <button class="map-control-btn" onclick="clearMapLayers()">
                                üóëÔ∏è Clear Map
                            </button>
                        </div>
                        
                        <!-- View Toggle (Before/After/Both) -->
                        <div class="view-toggle-panel">
                            <button class="toggle-btn active" id="btnAfter" onclick="showAfterView()">
                                ‚úÖ After (Corrected)
                            </button>
                            <button class="toggle-btn" id="btnBefore" onclick="showBeforeView()">
                                ‚ö†Ô∏è Before (Original)
                            </button>
                            <button class="toggle-btn" id="btnBoth" onclick="showBothViews()">
                                üîÑ Compare Both
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="loading" class="loading-overlay">
        <div class="spinner"></div>
        <div style="margin-top: 15px; color: #aaa;">Processing WKT file...</div>
    </div>

    <div id="toast" class="toast">Analysis complete!</div>

    <script src="js/wkt-processor-charts.js"></script>
</body>
</html>
